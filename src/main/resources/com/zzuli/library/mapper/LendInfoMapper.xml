<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zzuli.library.mapper.LendInfoMapper">
    <!--查询所有图书借阅信息-->
    <select id="listAllLendInfo" resultType="lendInfo">
        select * from lend_list
    </select>

    <!--查询指定reader_id的读者借阅信息-->
    <select id="listReadersLendInfo" resultType="lendInfo">
        select * from lend_list where reader_id = #{0}
    </select>

    <!--查询指定读者的未归还图书的book_id列表-->
    <select id="listNoReturnBooksId" parameterType="long" resultType="long">
        select book_id from lend_list where reader_id = #{0} and back_date is null
    </select>

    <!--删除指定流水号的图书借阅信息-->
    <delete id="deleteLendInfoBySerNum" parameterType="long">
        delete from lend_list where ser_num = #{ser_num}
    </delete>

    <!--新增一条借阅信息 借书-->
    <insert id="insertOneLendInfo" parameterType="lendInfo">
        insert into lend_list values (default, #{book_id}, #{reader_id}, SYSDATE(), null)
    </insert>

    <!--更新借阅记录 还书-->
    <delete id="updateLendInfo" parameterType="lendInfo">
        update lend_list set back_date = SYSDATE() where book_id = #{book_id} and reader_id = #{reader_id}
    </delete>
</mapper>